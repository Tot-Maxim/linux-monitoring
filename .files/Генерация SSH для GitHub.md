# SSH

## Генерация SSH ключа

Инструкция по генерации SSH-ключа и его настройке для использования с GitHub:

---

### 1. **Генерация нового SSH-ключа**

1. Введите команду для генерации нового SSH-ключа. Замените `your_email@example.com` на ваш email, который используется для GitHub:

   - Для алгоритма **ed25519** (рекомендуется):

     ```bash
     ssh-keygen -t ed25519 -C "your_email@example.com"
     ```

   - Если ваш SSH-клиент не поддерживает `ed25519`, используйте **RSA**:

     ```bash
     ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
     ```

2. Когда вас спросят, где сохранить ключ, нажмите `Enter`, чтобы сохранить ключ в стандартной директории (`~/.ssh/id_ed25519` или `~/.ssh/id_rsa`).

3. Далее вас попросят ввести парольную фразу (passphrase). Вы можете ввести парольную фразу для дополнительной безопасности или оставить поле пустым, нажав `Enter`.

---

### 2. **Добавление SSH-ключа в SSH-агент**

1. Запустите SSH-агент в фоновом режиме:

   ```bash
   eval "$(ssh-agent -s)"
   ```

2. Добавьте ваш приватный ключ в SSH-агент:

   - Для ключа `ed25519`:

     ```bash
     ssh-add ~/.ssh/id_ed25519
     ```

   - Для ключа `rsa`:

     ```bash
     ssh-add ~/.ssh/id_rsa
     ```

---

### 3. **Добавление SSH-ключа в GitHub**

1. Скопируйте содержимое вашего публичного ключа в буфер обмена:

   - Для ключа `ed25519`:

     ```bash
     cat ~/.ssh/id_ed25519.pub
     ```

   - Для ключа `rsa`:

     ```bash
     cat ~/.ssh/id_rsa.pub
     ```

   Выделите вывод команды и скопируйте его.

2. Перейдите на GitHub:
   - Нажмите на ваш аватар в правом верхнем углу и выберите **Settings**.
   - В боковом меню выберите **SSH and GPG keys**.
   - Нажмите **New SSH key** или **Add SSH key**.
   - В поле **Title** введите описание ключа (например, "My Laptop").
   - В поле **Key** вставьте содержимое вашего публичного ключа, которое вы скопировали ранее.
   - Нажмите **Add SSH key**.

---

### 4. **Проверка подключения**

1. Проверьте подключение к GitHub с помощью SSH:

   ```bash
   ssh -T git@github.com
   ```

2. Если всё настроено правильно, вы увидите сообщение:

   ```bash
   Hi username! You've successfully authenticated, but GitHub does not provide shell access.
   ```

---

### 5. **Использование SSH с Git**

Теперь вы можете использовать SSH для работы с репозиториями на GitHub. Например, чтобы клонировать репозиторий, используйте SSH-URL:

```bash
git clone git@github.com:username/repository.git
```

---

### 6. **Дополнительные советы**

- Если у вас несколько SSH-ключей, настройте файл `~/.ssh/config`, чтобы указать, какой ключ использовать для GitHub. Пример:

  ```plaintext
  Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_ed25519  # или ~/.ssh/id_rsa
    IdentitiesOnly yes
  ```

- Если вы столкнулись с ошибкой `Permission denied (publickey)`, проверьте, что ключ добавлен в SSH-агент и что вы скопировали **публичный ключ** в GitHub.

---

## Если Permission Denied и прочие ошибки

### 1. **Проверка прав доступа к файлам ключей**
SSH очень строг к правам доступа к файлам ключей. Убедитесь, что права настроены правильно:

- Приватный ключ (`id_ed25519` или `id_rsa`) должен иметь права `600` (только владелец может читать и записывать).
- Публичный ключ (`id_ed25519.pub` или `id_rsa.pub`) должен иметь права `644`.
- Директория `~/.ssh` должна иметь права `700`.
- А также проверьте владельца, должен быть не ROOT, а ваш пользователь

Исправьте права с помощью следующих команд:

```bash
chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_ed25519  # или ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_ed25519.pub  # или ~/.ssh/id_rsa.pub
```

---

### 2. **Проверка, что ключ добавлен в GitHub**
Убедитесь, что вы скопировали **публичный ключ** (содержимое файла `~/.ssh/id_ed25519.pub` или `~/.ssh/id_rsa.pub`) в настройках GitHub:

1. Перейдите в [GitHub SSH keys settings](https://github.com/settings/keys).
2. Убедитесь, что ключ добавлен.
3. Если ключ уже добавлен, удалите его и добавьте заново, чтобы убедиться, что он скопирован правильно.

---

### 3. **Проверка конфигурации SSH**
Убедитесь, что SSH использует правильный ключ. Откройте файл конфигурации SSH:

```bash
nano ~/.ssh/config
```

Добавьте или проверьте наличие следующей конфигурации:

```plaintext
Host github.com
  HostName github.com
  User git
  IdentityFile ~/.ssh/id_ed25519  # или ~/.ssh/id_rsa
  IdentitiesOnly yes
```

Сохраните файл и выйдите из редактора.

### 4. **Если ничего не помогло**
- Убедитесь, что вы используете правильный email при генерации ключа.
- Убедитесь, что вы используете правильный алгоритм ключа (GitHub рекомендует `ed25519`, но поддерживает и `rsa`).
- Если вы используете несколько SSH-ключей, убедитесь, что SSH-агент использует правильный ключ для GitHub.
