# Создание базы данных

---

## Шаг 0: Войти в сессию postgres

```sql
postgres=# 
```

## Шаг 1: Создание базы данных

```sql  
CREATE DATABASE fintech_credit_conveyor
    WITH OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'en_US.UTF-8'
    LC_CTYPE = 'en_US.UTF-8'
    TEMPLATE = template0;
```

## Шаг 1.1: Подключение к базе данных выполняется вручную после создания:

`\c fintech_credit_conveyor`

## Шаг 2: Создание таблиц
```sql  
CREATE TABLE IF NOT EXISTS clients (
    client_id SERIAL PRIMARY KEY,
    full_name VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    passport VARCHAR(20) UNIQUE NOT NULL,
    credit_score INT CHECK (credit_score BETWEEN 300 AND 850),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

```sql  
CREATE TABLE IF NOT EXISTS credit_products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    interest_rate NUMERIC(5,2) NOT NULL CHECK (interest_rate > 0),
    max_amount NUMERIC(15,2) NOT NULL,
    min_term INT NOT NULL,
    max_term INT NOT NULL
);
```

```sql  
CREATE TABLE IF NOT EXISTS credit_applications (
    application_id SERIAL PRIMARY KEY,
    client_id INT REFERENCES clients(client_id) ON DELETE CASCADE,
    product_id INT REFERENCES credit_products(product_id) ON DELETE SET NULL,
    amount NUMERIC(15,2) NOT NULL,
    term INT NOT NULL,
    status VARCHAR(50) DEFAULT 'submitted' CHECK (status IN ('submitted', 'approved', 'rejected', 'closed')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

```sql  
CREATE TABLE IF NOT EXISTS payments (
    payment_id SERIAL PRIMARY KEY,
    application_id INT REFERENCES credit_applications(application_id) ON DELETE CASCADE,
    amount_due NUMERIC(15,2) NOT NULL,
    payment_date DATE NOT NULL,
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'paid', 'overdue'))
);
```

```sql  
CREATE TABLE IF NOT EXISTS conveyor_log (
    log_id SERIAL PRIMARY KEY,
    application_id INT REFERENCES credit_applications(application_id),
    stage VARCHAR(50) NOT NULL,
    details JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Шаг 3: Создание индексов для оптимизации запросов
```sql
CREATE INDEX IF NOT EXISTS idx_client_passport ON clients(passport);
CREATE INDEX IF NOT EXISTS idx_application_status ON credit_applications(status);
CREATE INDEX IF NOT EXISTS idx_payment_status ON payments(status);
```





.
.
.
.
.
.
.
.
.
.
.
.
.





# ПРОВЕРЯЕМ ЧТО ВЫШЕ


Чтобы проверить созданную базу данных и все таблицы внутри, вы можете использовать следующие команды в PostgreSQL. Эти шаги помогут вам убедиться, что база данных и таблицы созданы корректно.

---

### **1. Проверка списка баз данных**
Используйте команду `SHOW DATABASES` или `\l` (сокращение для списка баз данных) в `psql`, чтобы увидеть все доступные базы данных :

```sql
\l
```

Это покажет список всех баз данных на вашем сервере PostgreSQL. Найдите в списке `fintech_credit_conveyor`, чтобы убедиться, что она создана.

---

### **2. Подключение к базе данных**
Подключитесь к созданной базе данных с помощью команды `\c`:

```sql
\c fintech_credit_conveyor
```

Если подключение успешно, вы увидите сообщение о том, что вы теперь работаете с этой базой данных.

---

### **3. Проверка таблиц в базе данных**
Чтобы увидеть все таблицы внутри базы данных, используйте команду `\dt` (отображает список таблиц) :

```sql
\dt
```

Эта команда покажет список всех таблиц в текущей базе данных. Вы должны увидеть следующие таблицы:
- `clients`
- `credit_products`
- `credit_applications`
- `payments`
- `conveyor_log`

---

### **4. Проверка структуры таблиц**
Чтобы проверить структуру конкретной таблицы (например, столбцы, типы данных, ограничения), используйте команду `\d` с именем таблицы:

```sql
\d clients
```

Эта команда покажет полное описание таблицы, включая:
- Имена столбцов.
- Типы данных.
- Ограничения (например, `PRIMARY KEY`, `UNIQUE`, `CHECK`).

Повторите эту команду для каждой таблицы, чтобы убедиться, что они созданы правильно.

---

### **5. Проверка данных в таблицах**
Если вы хотите убедиться, что данные добавлены в таблицы, выполните запрос `SELECT` для каждой таблицы. Например:

```sql
SELECT * FROM clients;
SELECT * FROM credit_products;
SELECT * FROM credit_applications;
SELECT * FROM payments;
SELECT * FROM conveyor_log;
```

Эти запросы покажут все строки в таблицах. Если таблицы пустые, это нормально, если вы только что создали базу данных и еще не добавили данные.

---

### **6. Проверка индексов**
Чтобы убедиться, что индексы созданы, используйте команду `\di` (отображает список индексов):

```sql
\di
```

Вы должны увидеть следующие индексы:
- `idx_client_passport`
- `idx_application_status`
- `idx_payment_status`

---

### **7. Дополнительная проверка через SQL-запросы**
Если вы хотите проверить базу данных программно (например, через PHP или другой язык), вы можете использовать SQL-запросы. Например, чтобы проверить наличие таблицы, выполните:

```sql
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public' AND table_name = 'clients';
```

Этот запрос вернет имя таблицы, если она существует .

---

### **8. Использование графического интерфейса (опционально)**
Если вы предпочитаете использовать графический интерфейс, такие инструменты, как pgAdmin или DBeaver, позволяют визуализировать базу данных, таблицы и их содержимое . Просто подключитесь к серверу PostgreSQL и выберите базу данных `fintech_credit_conveyor`.

---

### **Заключение**
Следуя этим шагам, вы сможете проверить, что база данных `fintech_credit_conveyor` и все связанные таблицы созданы корректно. Если что-то отсутствует или выдает ошибку, вернитесь к скрипту создания базы данных и проверьте его выполнение. 

Если возникнут дополнительные вопросы, обращайтесь! 
