# создать базу под сессией внутри **postgres=#** 

## Шаг 1: Создание базы данных

```sql  
CREATE DATABASE fintech_credit_conveyor
    WITH OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'en_US.UTF-8'
    LC_CTYPE = 'en_US.UTF-8'
    TEMPLATE = template0;
```

## Шаг 1.1: Подключение к базе данных выполняется вручную после создания:

`\c fintech_credit_conveyor`

## Шаг 2: Создание таблиц
```sql  
CREATE TABLE IF NOT EXISTS clients (
    client_id SERIAL PRIMARY KEY,
    full_name VARCHAR(255) NOT NULL,
    birth_date DATE NOT NULL,
    passport VARCHAR(20) UNIQUE NOT NULL,
    credit_score INT CHECK (credit_score BETWEEN 300 AND 850),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

```sql  
CREATE TABLE IF NOT EXISTS credit_products (
    product_id SERIAL PRIMARY KEY,
    product_name VARCHAR(100) NOT NULL,
    interest_rate NUMERIC(5,2) NOT NULL CHECK (interest_rate > 0),
    max_amount NUMERIC(15,2) NOT NULL,
    min_term INT NOT NULL,
    max_term INT NOT NULL
);
```

```sql  
CREATE TABLE IF NOT EXISTS credit_applications (
    application_id SERIAL PRIMARY KEY,
    client_id INT REFERENCES clients(client_id) ON DELETE CASCADE,
    product_id INT REFERENCES credit_products(product_id) ON DELETE SET NULL,
    amount NUMERIC(15,2) NOT NULL,
    term INT NOT NULL,
    status VARCHAR(50) DEFAULT 'submitted' CHECK (status IN ('submitted', 'approved', 'rejected', 'closed')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

```sql  
CREATE TABLE IF NOT EXISTS payments (
    payment_id SERIAL PRIMARY KEY,
    application_id INT REFERENCES credit_applications(application_id) ON DELETE CASCADE,
    amount_due NUMERIC(15,2) NOT NULL,
    payment_date DATE NOT NULL,
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'paid', 'overdue'))
);
```

```sql  
CREATE TABLE IF NOT EXISTS conveyor_log (
    log_id SERIAL PRIMARY KEY,
    application_id INT REFERENCES credit_applications(application_id),
    stage VARCHAR(50) NOT NULL,
    details JSONB,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## Шаг 3: Создание индексов для оптимизации запросов
```sql
CREATE INDEX IF NOT EXISTS idx_client_passport ON clients(passport);
CREATE INDEX IF NOT EXISTS idx_application_status ON credit_applications(status);
CREATE INDEX IF NOT EXISTS idx_payment_status ON payments(status);
```
