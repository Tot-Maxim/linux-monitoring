# Prometheus

## Введение
### Как работает Prometheus и для чего он нужен

**Prometheus** — это система мониторинга с открытым исходным кодом, созданная для сбора и анализа метрик производительности систем и приложений. Он был разработан специально для работы в условиях микросервисной архитектуры и активно используется в экосистеме Kubernetes.

#### **Как работает Prometheus:**
- **Сбор данных:** Prometheus периодически опрашивает (pull) таргеты (цели), которые предоставляют экспортёры (exporters). Экспортёры преобразуют данные из различных источников (например, операционных систем, баз данных, приложений) в формат, понятный Prometheus.
- **Хранение данных:** Собранные метрики хранятся локально в временной базе данных на каждом узле Prometheus. Это позволяет быстро выполнять запросы без необходимости обращаться к внешним хранилищам.
- **Агрегация и анализ:** Prometheus предоставляет мощный язык запросов PromQL (Prometheus Query Language), который позволяет агрегировать, фильтровать и анализировать данные.
- **Алертинг:** Prometheus поддерживает создание правил алертинга, которые могут отправлять уведомления через интеграции с различными системами (например, Slack, PagerDuty, email).
- **Визуализация:** Prometheus может работать с Grafana для создания дашбордов, что позволяет наглядно представлять данные о производительности.

#### **Для чего нужен Prometheus:**
- **Мониторинг производительности:** Отслеживание метрик производительности серверов, контейнеров, баз данных, приложений.
- **Обнаружение проблем:** Быстрое выявление проблем в работе системы через алертинг и анализ метрик.
- **Оптимизация ресурсов:** Анализ использования ресурсов (CPU, память, диск, сеть) для оптимизации инфраструктуры.
- **Прогнозирование:** Использование исторических данных для прогнозирования будущих нагрузок и планирования масштабирования.
- **Интеграция с микросервисами:** Простая интеграция с современными архитектурами, такими как Kubernetes, Docker, и другие облачные платформы.

---

### Pull и Push модель в Prometheus

Prometheus использует **pull модель** по умолчанию, но также поддерживает использование **push модели** через дополнительные компоненты.

#### **Pull модель:**
- **Как работает:**
  - Prometheus регулярно запрашивает (pull) метрики у таргетов (целей), которые должны предоставлять их через HTTP-интерфейс.
  - Интервал опроса настраивается в конфигурационном файле Prometheus.
  - Таргеты могут быть статически настроены или автоматически обнаруживаться через сервисные открытия (service discovery).

- **Преимущества:**
  - Простота реализации: Prometheus управляет всем процессом сбора данных.
  - Надежность: Если таргет недоступен, Prometheus сразу об этом узнает и может сгенерировать алерт.
  - Меньше зависимости от сторонних компонентов.

- **Недостатки:**
  - Не всегда удобно использовать в сценариях, где таргеты находятся за NAT или брандмауэром.
  - Может быть сложно настроить для временных рабочих нагрузок (например, batch jobs).

#### **Push модель:**
- **Как работает:**
  - В push модели данные отправляются (push) в специальный компонент — **Pushgateway**.
  - Приложения или задачи отправляют свои метрики в Pushgateway, а Prometheus затем забирает эти данные с Pushgateway через pull.

- **Когда используется:**
  - Для временных рабочих нагрузок (например, batch jobs), которые не могут существовать достаточно долго для того, чтобы Prometheus мог их опросить.
  - Когда таргеты находятся за NAT или брандмауэром и недоступны напрямую для Prometheus.

- **Преимущества:**
  - Подходит для сценариев, где таргеты недолго существуют или находятся за ограничениями сети.
  - Упрощает работу с временными задачами.

- **Недостатки:**
  - Дополнительная сложность в архитектуре из-за необходимости использования Pushgateway.
  - Вероятность потери данных, если приложение завершается до того, как успело отправить метрики.

---

### Сравнение Pull и Push моделей:

| **Параметр** | **Pull модель** | **Push модель** |
|--------------|-----------------|-----------------|
| **Основной механизм** | Prometheus опрашивает таргеты | Таргеты отправляют данные в Pushgateway |
| **Когда использовать** | Для постоянных сервисов | Для временных задач или защищенных сетей |
| **Зависимость от доступности** | Требует доступности таргетов | Не требует постоянного доступа к таргетам |
| **Компоненты** | Только Prometheus | Prometheus + Pushgateway |
| **Сложность** | Простая | Сlightly более сложная |

---

- Prometheus в основном использует pull модель, которая является более надежной и простой в реализации для большинства случаев.
- Push модель через Pushgateway используется в специальных случаях, таких как временные задачи или ограниченные сетевые условия.
- Выбор между pull и push зависит от конкретных требований вашей инфраструктуры и типов мониторинга.

---
