В **Prometheus** метрики используются для сбора и анализа данных о производительности, состоянии и работе систем. Они имеют строгую типизацию, что позволяет эффективно работать с ними при анализе и мониторинге. Рассмотрим основные виды и типы метрик в Prometheus.

---

### **Типы метрик в Prometheus**

Prometheus поддерживает четыре основных типа метрик:

1. **Counter (Счетчик)**  
   - Представляет собой метрику, значение которой только увеличивается со временем или сбрасывается до нуля при перезапуске системы.
   - Используется для подсчета событий, таких как количество запросов, ошибок или обработанных данных.
   - Пример: `http_requests_total` — общее количество HTTP-запросов.

   **Характеристики:**
   - Значение всегда возрастает или остается неизменным.
   - Может быть использовано для расчета скорости изменений (rate).

   **Пример:**
   ```plaintext
   http_requests_total{method="GET", handler="/api"} 12345
   ```

2. **Gauge (Показатель)**  
   - Представляет собой метрику, значение которой может увеличиваться или уменьшаться.
   - Используется для измерения состояний, таких как использование CPU, памяти, температура или количество активных процессов.
   - Пример: `cpu_usage_percent` — текущая загрузка CPU.

   **Характеристики:**
   - Значение может изменяться в любую сторону.
   - Подходит для отслеживания динамических показателей.

   **Пример:**
   ```plaintext
   temperature_celsius{sensor="thermometer"} 25.5
   ```

3. **Histogram (Гистограмма)**  
   - Представляет собой метрику, которая группирует наблюдаемые значения в диапазоны (buckets).
   - Используется для измерения распределения значений, например, времени выполнения запросов или размеров ответов.
   - Пример: `request_duration_seconds` — время выполнения HTTP-запросов.

   **Характеристики:**
   - Состоит из нескольких бакетов (диапазонов) и счетчика общего количества наблюдений (`_sum` и `_count`).
   - Позволяет рассчитывать процентили и средние значения.

   **Пример:**
   ```plaintext
   request_duration_seconds_bucket{le="0.1"} 120
   request_duration_seconds_bucket{le="0.5"} 300
   request_duration_seconds_bucket{le="1.0"} 450
   request_duration_seconds_sum 500.0
   request_duration_seconds_count 500
   ```

4. **Summary (Сводка)**  
   - Представляет собой метрику, которая вычисляет агрегированные значения, такие как среднее, медиана или процентили.
   - Используется для подсчета статистики по наблюдаемым данным.
   - Пример: `response_size_bytes` — размер ответов сервера.

   **Характеристики:**
   - Содержит заранее вычисленные процентили и суммарное количество наблюдений.
   - Менее гибкий, чем гистограммы, но более эффективный для некоторых случаев использования.

   **Пример:**
   ```plaintext
   response_size_bytes{quantile="0.5"} 1234
   response_size_bytes{quantile="0.9"} 2345
   response_size_bytes_sum 500000
   response_size_bytes_count 1000
   ```

---

### **Разница между Histogram и Summary**

| Характеристика         | Histogram                              | Summary                                |
|------------------------|----------------------------------------|----------------------------------------|
| Бакеты                 | Есть (диапазоны значений)              | Нет                                    |
| Процентили             | Вычисляются на клиенте или сервере     | Вычисляются заранее на клиенте         |
| Гибкость               | Можно агрегировать данные на сервере    | Нельзя агрегировать данные на сервере   |
| Использование          | Для анализа распределения значений      | Для предварительно вычисленной статистики |

---

### **Метки (Labels)**

Каждая метрика в Prometheus может иметь **метки** (labels) — пары "ключ-значение", которые позволяют классифицировать данные. Например:
```plaintext
http_requests_total{method="GET", handler="/api"} 12345
```
Здесь:
- `method="GET"` — метка, указывающая метод HTTP.
- `handler="/api"` — метка, указывающая обработчик запроса.

Метки делают метрики более гибкими и позволяют фильтровать и группировать данные.

---

### **Примеры использования типов метрик**

1. **Counter**: Подсчет количества ошибок в системе.
   ```plaintext
   http_errors_total{status="500"} 12
   ```

2. **Gauge**: Отслеживание загрузки памяти.
   ```plaintext
   memory_usage_bytes 8500000000
   ```

3. **Histogram**: Измерение времени выполнения запросов.
   ```plaintext
   request_duration_seconds_bucket{le="0.5"} 100
   request_duration_seconds_sum 120.0
   request_duration_seconds_count 200
   ```

4. **Summary**: Вычисление среднего размера ответов.
   ```plaintext
   response_size_bytes{quantile="0.95"} 1500
   response_size_bytes_sum 300000
   response_size_bytes_count 200
   ```

---

### **Заключение**

В Prometheus каждый тип метрики имеет свои особенности и области применения:
- **Counter** используется для подсчета событий.
- **Gauge** применяется для измерения динамических показателей.
- **Histogram** и **Summary** подходят для анализа распределения данных.

Выбор конкретного типа зависит от задачи мониторинга и требуемого уровня детализации данных.
