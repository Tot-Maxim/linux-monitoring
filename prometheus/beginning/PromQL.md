7. **PromQL**
   
   Это язык запросов для работы с временными рядами в Prometheus. Он позволяет фильтровать, агрегировать и анализировать метрики, вычислять скорости изменения (rate), перцентили (histogram_quantile) и прогнозировать тренды (predict_linear). Используется для мониторинга, визуализации и настройки оповещений. Прост в использовании, но мощный для анализа производительности систем.

   Таблицы с основными функциями агрегирования и запросов в Prometheus, структурированные по категориям:

   #### Таблица 1: Основные агрегирующие функции
   
   | Функция | Описание | Пример использования |
   |---------|----------|----------------------|
   | `sum()` | Сумма значений | `sum(http_requests_total)` |
   | `avg()` | Среднее значение | `avg(http_request_duration_seconds)` |
   | `max()` | Максимальное значение | `max(node_memory_MemTotal)` |
   | `min()` | Минимальное значение | `min(node_cpu_seconds_total)` |
   | `stddev()` | Стандартное отклонение | `stddev(http_request_duration_seconds)` |
   | `stdvar()` | Дисперсия | `stdvar(http_request_duration_seconds)` |
   | `count()` | Количество элементов | `count(http_requests_total)` |
   
   ---
   
   #### Таблица 2: Функции для работы со временем
   
   | Функция | Описание | Пример использования |
   |---------|----------|----------------------|
   | `rate()` | Скорость изменения за интервал времени | `rate(http_requests_total[5m])` |
   | `irate()` | Скорость изменения между последними двумя точками | `irate(http_requests_total[5m])` |
   | `delta()` | Разница между первым и последним значением | `delta(node_filesystem_free[1h])` |
   | `increase()` | Увеличение счетчика за интервал времени | `increase(http_requests_total[1h])` |
   | `time()` | Текущее время в секундах с Unix epoch | `time()` |
   
   ---
   
   #### Таблица 3: Функции для распределений и квантилей
   
   | Функция | Описание | Пример использования |
   |---------|----------|----------------------|
   | `histogram_quantile(φ, ...)` | Расчет квантиля из histogram | `histogram_quantile(0.95, rate(http_request_duration_seconds_bucket[5m]))` |
   | `quantile_over_time(φ, ...)` | Расчет квантиля за временной интервал | `quantile_over_time(0.95, http_request_duration_seconds[5m])` |
   | `avg_over_time(...)` | Среднее значение за временной интервал | `avg_over_time(http_request_duration_seconds[5m])` |
   | `max_over_time(...)` | Максимальное значение за временной интервал | `max_over_time(http_request_duration_seconds[5m])` |
   | `min_over_time(...)` | Минимальное значение за временной интервал | `min_over_time(http_request_duration_seconds[5m])` |
   
   ---
   
   #### Таблица 4: Функции для группировки и фильтрации
   
   | Функция | Описание | Пример использования |
   |---------|----------|----------------------|
   | `by` | Группировка по указанным меткам | `sum(http_requests_total) by (method)` |
   | `without` | Исключение указанных меток из группировки | `sum(http_requests_total) without (instance)` |
   | `label_replace()` | Замена меток | `label_replace(http_requests_total, "new_label", "$1", "old_label", "(.*)")` |
   | `label_join()` | Объединение меток | `label_join(http_requests_total, "combined", "_", "label1", "label2")` |
   
   ---
   
   #### Таблица 5: Математические и логические функции
   
   | Функция | Описание | Пример использования |
   |---------|----------|----------------------|
   | `abs()` | Абсолютное значение | `abs(http_request_duration_seconds)` |
   | `ceil()` | Округление вверх | `ceil(http_request_duration_seconds)` |
   | `floor()` | Округление вниз | `floor(http_request_duration_seconds)` |
   | `round()` | Округление до ближайшего целого | `round(http_request_duration_seconds)` |
   | `clamp_min()` | Ограничение минимального значения | `clamp_min(http_request_duration_seconds, 0)` |
   | `clamp_max()` | Ограничение максимального значения | `clamp_max(http_request_duration_seconds, 10)` |
   
   ---
   
   #### Таблица 6: Логические операторы
   
   | Оператор | Описание | Пример использования |
   |----------|----------|----------------------|
   | `==` | Равно | `http_requests_total == 100` |
   | `!=` | Не равно | `http_requests_total != 0` |
   | `>` | Больше | `http_request_duration_seconds > 1` |
   | `<` | Меньше | `http_request_duration_seconds < 0.5` |
   | `>=` | Больше или равно | `http_requests_total >= 100` |
   | `<=` | Меньше или равно | `http_request_duration_seconds <= 2` |
   
   ---
   
   #### Таблица 7: Встроенные константы и функции
   
   | Константа/Функция | Описание | Пример использования |
   |--------------------|----------|----------------------|
   | `up` | Состояние доступности таргета (1 - доступен, 0 - недоступен) | `up{job="api"}` |
   | `time()` | Текущее время в секундах с Unix epoch | `time()` |
   | `scalar()` | Преобразование в скалярное значение | `scalar(sum(http_requests_total))` |
   | `vector()` | Преобразование в вектор | `vector(1)` |
   
   ---
   
   #### Комментарий к таблицам:
   
   1. **Агрегирующие функции** (`sum`, `avg`, `max`, `min`) используются для объединения данных.
   2. **Функции для работы со временем** (`rate`, `irate`, `delta`, `increase`) помогают анализировать динамику изменений.
   3. **Функции для распределений и квантилей** (`histogram_quantile`, `quantile_over_time`) применяются для анализа гистограмм и summary метрик.
   4. **Группировка и фильтрация** (`by`, `without`, `label_replace`) позволяют управлять метками и группировать данные.
   5. **Математические и логические функции** обеспечивают возможность выполнять различные преобразования и сравнения.
   
   Эти таблицы можно использовать как справочник при написании запросов в Prometheus.
