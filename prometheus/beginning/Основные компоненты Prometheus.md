### **Основные компоненты Prometheus**

Prometheus представляет собой комплексную систему мониторинга, состоящую из нескольких ключевых компонентов, каждый из которых выполняет определенные функции. Ниже описаны основные компоненты системы:

1. **Prometheus Server**  
   - Основной компонент, отвечающий за сбор, хранение и обработку метрик.
   - Выполняет скрейпинг (scraping) данных с целевых систем через HTTP-интерфейсы.
   - Хранит данные во встроенной базе временных рядов (TSDB).
   - Поддерживает язык запросов PromQL для анализа данных.

2. **Экспортеры (Exporters)**  
   - Программы или службы, которые собирают метрики из различных источников (например, операционных систем, баз данных, приложений) и предоставляют их в формате, понятном Prometheus.
   - Примеры: Node Exporter, MySQL Exporter, Nginx Exporter.

3. **Pushgateway**  
   - Компонент, который позволяет временным задачам (batch jobs) отправлять метрики на сервер Prometheus.
   - Используется в случаях, когда традиционный pull-модель скрейпинга не применима.

4. **Alertmanager**  
   - Отдельный компонент для управления алертами.
   - Обрабатывает уведомления от Prometheus, группирует их, подавляет дубликаты и отправляет оповещения через различные каналы (например, email, Slack, PagerDuty).

5. **Клиентские библиотеки**  
   - Библиотеки для различных языков программирования (Go, Java, Python и др.), позволяющие интегрировать Prometheus с пользовательскими приложениями.
   - Они помогают экспортировать метрики из приложений в формате Prometheus.

6. **Внешние системы хранения** *(необязательно)*  
   - Prometheus может быть интегрирован с внешними системами долгосрочного хранения (remote storage), такими как Thanos или Cortex, для архивации данных за пределами TSDB.

---

### **Схема работы Prometheus**

На академическом уровне работа Prometheus можно представить следующим образом:


                                             +-------------------+       +---------------------+       +------------------+
                                             |                   |       |                     |       |                  |
                                             |  Целевые системы  +------->  Экспортеры          +------->  Prometheus    |
                                             |  (Applications,   |       |  (Node Exporter,    |       |  Server          |
                                             |   Services, etc.) |       |   MySQL Exporter,   |       |                  |
                                             |                   |       |   etc.)             |       |                  |
                                             +-------------------+       +---------------------+       +------------------+
                                                                                                          |         ^
                                                                                                          |         |
                                                                                                          v         |
                                                                                                +------------------+---------+
                                                                                                |                   |         |
                                                                                                |   Pushgateway     |         |
                                                                                                |                   |         |
                                                                                                +------------------+---------+
                                                                                                          |
                                                                                                          v
                                                                                                 +-----------------------------+
                                                                                                 |                             |
                                                                                                 |      Alertmanager           |
                                                                                                 |                             |
                                                                                                 +-----------------------------+
                                                                                                          |
                                                                                                          v
                                                                                                 +-----------------------------+
                                                                                                 |                             |
                                                                                                 |   Внешние каналы оповещений  |
                                                                                                 |   (Email, Slack, PagerDuty)  |
                                                                                                 +-----------------------------+


### **Описание схемы**

1. **Целевые системы**: Это могут быть приложения, сервисы или инфраструктурные компоненты, которые предоставляют метрики через HTTP-интерфейсы.

2. **Экспортеры**: Экспортеры собирают метрики из целевых систем и предоставляют их в формате, понятном Prometheus. Например:
   - **Node Exporter** — для мониторинга ресурсов ОС.
   - **MySQL Exporter** — для мониторинга базы данных MySQL.

3. **Prometheus Server**:
   - Выполняет скрейпинг метрик с экспортеров.
   - Сохраняет данные во встроенной базе временных рядов (TSDB).
   - Позволяет выполнять запросы к данным с помощью PromQL.

4. **Pushgateway**:
   - Принимает метрики от временных задач (batch jobs) и предоставляет их Prometheus для скрейпинга.
   - Используется, когда целевая система недоступна для постоянного скрейпинга.

5. **Alertmanager**:
   - Получает алерты от Prometheus.
   - Группирует, фильтрует и направляет уведомления через внешние каналы (например, email, Slack, PagerDuty).

6. **Внешние системы хранения** *(опционально)*:
   - Prometheus может быть настроен для отправки данных в удаленные хранилища (например, Thanos, Cortex) для долгосрочного хранения.

---

### **Академическое описание процесса работы**

1. **Сбор данных**:
   - Prometheus периодически выполняет скрейпинг метрик с целевых систем через экспортеры.
   - Метрики предоставляются в формате временных рядов, где каждая точка данных связана с меткой времени.

2. **Хранение данных**:
   - Собранные метрики сохраняются во встроенной базе данных временных рядов (TSDB).
   - Данные организованы в блоки, каждый из которых охватывает конкретный временной интервал.

3. **Анализ данных**:
   - Prometheus предоставляет язык запросов PromQL для анализа и агрегации данных.
   - Пользователи могут выполнять сложные запросы для получения статистики, расчета производных показателей и построения графиков.

4. **Управление алертами**:
   - Prometheus отправляет алерты в Alertmanager, если заданные условия нарушаются.
   - Alertmanager обрабатывает алерты, группирует их и направляет уведомления через настроенные каналы.

5. **Долгосрочное хранение**:
   - Для архивации данных за пределами TSDB можно использовать внешние системы хранения, такие как Thanos или Cortex.

Таким образом, Prometheus представляет собой комплексную систему мониторинга, объединяющую сбор, хранение, анализ и управление метриками в единой архитектуре.
