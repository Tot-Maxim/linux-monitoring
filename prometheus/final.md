### **Базовые вопросы о Prometheus к собеседованию**  
**1. Что такое Prometheus и чем он полезен в DevOps?**  
Prometheus — это open-source система мониторинга, которая собирает и анализирует метрики серверов, приложений и баз данных в реальном времени .  
**Полезен в DevOps**:  
- Позволяет отслеживать состояние инфраструктуры (CPU, память, сеть).  
- Интегрируется с Kubernetes, микросервисами и облачными платформами .  
- Обеспечивает быструю диагностику проблем через PromQL .  

**2. Чем Prometheus отличается от Grafana?**  
- **Prometheus** — система сбора и хранения метрик.  
- **Grafana** — инструмент визуализации данных (панели мониторинга).  
Часто используют вместе: Prometheus хранит данные, Grafana отображает их , .  

---

### **Архитектура и компоненты**  
**3. Опишите архитектуру Prometheus**  
- **Сервер Prometheus**: Собирает метрики через HTTP, хранит их в TSDB (база временных рядов) .  
- **Exporters**: Экспортируют метрики из приложений (Node Exporter для серверов, Spring Boot Actuator для Java) .  
- **Pushgateway**: Принимает метрики от короткоживущих задач (например, cron) .  
- **Alertmanager**: Управляет оповещениями (группировка, подавление, отправка в Slack/Email) .  

**4. Зачем нужен Pushgateway?**  
Для сбора метрик от задач, которые существуют недолго (например, cron-скрипты).  
Prometheus обычно "тянет" метрики, но Pushgateway позволяет задачам "пропушить" данные перед завершением .  

---

### **PromQL**  
**5. Примеры запросов для анализа метрик**  
- `rate(http_requests_total[5m])` — скорость запросов за 5 минут .  
- `sum(container_memory_usage_bytes) by (pod)` — память по Pod’ам в Kubernetes .  
- `histogram_quantile(0.95, http_request_duration_seconds_bucket)` — 95-й перцентиль времени ответа .  

**6. Как рассчитать среднее значение метрики за 1 час?**  
Используйте `avg_over_time(metric_name[1h])` .  

---

### **Практические сценарии**  
**7. Как мониторить приложения на Spring Boot?**  
- Добавьте зависимость **Micrometer** и **Spring Boot Actuator**.  
- Метрики будут доступны по `/actuator/prometheus`, их может собирать Prometheus .  

**8. Как Prometheus работает с Kubernetes?**  
- Использует **Service Discovery** для автоматического обнаружения Pod’ов, сервисов и нод .  
- Пример конфигурации:  
  ```yaml
  kubernetes_sd_configs:
    - role: pod
  ```  
  Метрики собираются через exporters (например, cAdvisor для контейнеров) .  

---

### **Алертинг**  
**9. Как настроить оповещения через Alertmanager?**  
1. Создайте правила алертинга в Prometheus:  
   ```yaml
   groups:
     - name: example
       rules:
         - alert: HighCPUUsage
           expr: node_cpu_usage > 90
           for: 5m
   ```  
2. Настройте Alertmanager для отправки уведомлений (Slack, Email):  
   ```yaml
   receivers:
     - name: 'slack-notifications'
       slack_configs:
         - channel: '#alerts'
   ``` .  

---

### **Продвинутые темы**  
**10. Какие ограничения у Prometheus?**  
- Не подходит для долгосрочного хранения (данные хранятся неделями) .  
- Нет встроенной распределенной архитектуры (масштабирование через федерацию) .  

**11. Как обеспечить долгосрочное хранение данных?**  
- Используйте **Thanos** или **Cortex** для объединения нескольких Prometheus и долгосрочного хранения в объектном хранилище (S3) .  
- Альтернатива: экспортируйте данные в сторонние TSDB (например, InfluxDB) .  

--- 

**Совет**: Практикуйтесь в написании PromQL-запросов на тестовых данных, чтобы быстро решать задачи на собеседовании!
