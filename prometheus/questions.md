### **Базовые вопросы к собеседованию**

1. **Что такое Prometheus? Для чего он используется?**  
   Prometheus — это система мониторинга с открытым исходным кодом, используемая для сбора метрик, их хранения и визуализации. Она часто применяется для мониторинга инфраструктуры, микросервисов и приложений.

2. **Какие основные компоненты включает Prometheus?**  
   - **Prometheus Server**: Собирает и хранит метрики.  
   - **Exporters**: Программы, которые предоставляют метрики для сбора (например, Node Exporter).  
   - **Alertmanager**: Обрабатывает алерты и отправляет уведомления.  
   - **Pushgateway**: Позволяет отправлять метрики в Prometheus через push-механизм.

3. **Как работает архитектура Prometheus?**  
   Prometheus работает по модели "pull": сервер периодически запрашивает метрики у целевых сервисов (targets) через HTTP. Метрики хранятся в локальной базе данных TSDB (Time Series Database).

4. **Что такое метрика в Prometheus? Какие типы метрик поддерживаются?**  
   Метрика — это числовое значение с метками (labels), которое изменяется во времени. Типы метрик:  
   - **Counter**: Счётчик, который только увеличивается.  
   - **Gauge**: Изменяемое значение (может увеличиваться или уменьшаться).  
   - **Histogram**: Гистограмма для анализа распределения значений.  
   - **Summary**: Сводка для расчета квантилей (percentiles).

5. **Как Prometheus собирает метрики?**  
   Prometheus периодически отправляет HTTP-запросы к endpoints `/metrics` на целевых сервисах (targets). Эти endpoints предоставляют метрики в текстовом формате.

6. **Что такое Exporter в Prometheus? Приведите примеры.**  
   Exporter — это программа, которая предоставляет метрики для сбора Prometheus. Примеры:  
   - **Node Exporter**: Собирает метрики системы (CPU, память, диск).  
   - **Blackbox Exporter**: Проверяет доступность сервисов (HTTP, TCP, DNS).  
   - **MySQL Exporter**: Собирает метрики MySQL.

7. **Как настроить сбор метрик в Prometheus?**  
   Настройте файл `prometheus.yml`: добавьте targets в раздел `scrape_configs`, укажите интервал сбора метрик (`scrape_interval`).

---

### **Настройка и конфигурирование**

8. **Как установить Prometheus?**  
   Используйте Docker (`docker run prom/prometheus`), скачайте бинарный файл с официального сайта или установите через пакетный менеджер (например, `apt` или `yum`).

9. **Как настроить Pushgateway в Prometheus?**  
   Установите Pushgateway → Настройте его endpoint в `prometheus.yml` → Отправляйте метрики через HTTP POST.

10. **Как настроить Alertmanager в Prometheus?**  
    Установите Alertmanager → Настройте его в `prometheus.yml` → Создайте правила алертов в файлах `*.rules`.

11. **Как создать правило алерта в Prometheus?**  
    Добавьте файл с правилами (например, `alerts.yml`) → Опишите условие срабатывания в PromQL → Укажите параметры уведомлений.

12. **Как проверить, что Prometheus корректно собирает метрики?**  
    Перейдите в UI Prometheus → Вкладка "Targets" → Проверьте статус целевых сервисов (UP/DOWN).

---

### **PromQL (Prometheus Query Language)**

13. **Что такое PromQL? Для чего он используется?**  
    PromQL — это язык запросов Prometheus, используемый для выборки, фильтрации и анализа метрик.

14. **Приведите пример простого запроса PromQL.**  
    `up` — показывает доступность целевых сервисов.  
    `rate(http_requests_total[5m])` — скорость роста HTTP-запросов за последние 5 минут.

15. **Как использовать метки (labels) в PromQL?**  
    Метки позволяют фильтровать метрики. Пример:  
    `http_requests_total{method="GET", status="200"}` — выбирает только GET-запросы с кодом 200.

16. **Как рассчитать среднее значение метрики за определённый период?**  
    Используйте функцию `avg_over_time(metric_name[duration])`. Например:  
    `avg_over_time(cpu_usage[1h])` — среднее использование CPU за последний час.

17. **Как объединить несколько метрик в PromQL?**  
    Используйте операторы:  
    - `+`, `-`, `*`, `/` — арифметические операции.  
    - `and`, `or`, `unless` — логические операции.  

---

### **Алерты и уведомления**

18. **Как настроить алерт в Prometheus?**  
    Создайте файл с правилами алертов → Настройте условие срабатывания в PromQL → Укажите параметры уведомлений в Alertmanager.

19. **В чем разница между Prometheus Alerts и Alertmanager?**  
    Prometheus генерирует алерты на основе правил, а Alertmanager управляет уведомлениями (группировка, отправка).

20. **Какие каналы уведомлений поддерживает Alertmanager?**  
    Email, Slack, PagerDuty, Telegram, Webhook.

21. **Как настроить повторяющиеся уведомления для алертов?**  
    Настройте параметр `repeat_interval` в конфигурации Alertmanager.

---

### **Интеграция с другими системами**

22. **Как интегрировать Prometheus с Grafana?**  
    Добавьте Prometheus как источник данных в Grafana → Используйте PromQL для создания дашбордов.

23. **Как использовать Node Exporter для мониторинга серверов?**  
    Установите Node Exporter → Настройте его endpoint в `prometheus.yml` → Используйте метрики (например, `node_cpu_seconds_total`).

24. **Как Prometheus работает с Kubernetes?**  
    Используйте Service Discovery для автоматического обнаружения сервисов в Kubernetes. Настройте `kubernetes_sd_config` в `prometheus.yml`.

25. **Как мониторить базы данных с помощью Prometheus?**  
    Используйте соответствующие Exporters (например, MySQL Exporter, PostgreSQL Exporter).

---

### **Производительность и оптимизация**

26. **Как оптимизировать производительность Prometheus?**  
    - Уменьшите количество собираемых метрик.  
    - Используйте эффективные PromQL-запросы.  
    - Настройте retention данных (время хранения).  

27. **Как настроить время хранения данных в Prometheus?**  
    Настройте параметр `retention` в `prometheus.yml`. Например:  
    `retention: 30d` — хранение данных в течение 30 дней.

28. **Как мониторить сам Prometheus?**  
    Используйте встроенные метрики Prometheus (например, `prometheus_target_interval_length_seconds`).

29. **Как организовать централизованное хранение данных Prometheus?**  
    Используйте Thanos или Cortex для агрегации и долгосрочного хранения данных.

30. **Как настроить высокую доступность (High Availability) для Prometheus?**  
    Запустите несколько экземпляров Prometheus → Настройте общее хранилище для данных.

---

### **Продвинутые вопросы**

31. **Как использовать Prometheus в микросервисной архитектуре?**  
    Настройте Service Discovery для автоматического обнаружения сервисов → Используйте метрики для каждого микросервиса.

32. **Что такое Federation в Prometheus?**  
    Federation позволяет одному Prometheus собирать данные с других Prometheus-серверов для агрегации.

33. **Как использовать Recording Rules в Prometheus?**  
    Recording Rules позволяют предварительно вычислять сложные PromQL-запросы и сохранять их как новые метрики.

34. **Как настроить мониторинг логов с помощью Prometheus?**  
    Используйте Loki для анализа логов → Интегрируйте Loki с Prometheus.

35. **Как создать собственный Exporter для Prometheus?**  
    Напишите программу, которая предоставляет метрики в формате Prometheus (например, на Python с использованием библиотеки `prometheus_client`).
