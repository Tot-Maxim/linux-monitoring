# Prometheus
### Основные понятия Prometheus:

1. **Метрика (Metric)** в Prometheus — это числовая характеристика системы, которую можно измерить (например, `http_requests_total`). Она описывает состояние или поведение компонента (CPU, память, ошибки и т.д.).  
  - **Лейбл (Label)** — это пара ключ-значение, добавляющая контекст к метрике. Например, метрика `http_requests_total` может иметь лейблы `method="POST"`, `path="/api"`, `status_code="200"`, что позволяет группировать и фильтровать данные.
  - **Типы метрик**:
    - **Counter** — монотонно возрастающее значение (например, общее число запросов).
    - **Gauge** — значение, которое может увеличиваться или уменьшаться (например, использование памяти).
    - **Histogram** — группирует данные в "корзины" (например, время ответа).
    - **Summary** — аналогичен гистограмме, но вычисляет квантили на стороне сервера.

2. **Временной ряд (Time Series)**  
   Уникальная комбинация:
   - Имя метрики (например, `node_cpu_seconds_total`).
   - Набор лейблов (например, `cpu="0", mode="user"`).

3. **Экспортер (Exporter)**  
   Сервис, преобразующий данные из внешней системы (например, MySQL, Node.js) в формат Prometheus.

4. **PromQL**  
   Язык запросов для анализа данных (например, `rate(http_requests_total[5m])`).

5. **Сервис-дискавери (Service Discovery)**  
   Автоматическое обнаружение целей для сбора метрик (Kubernetes, AWS, Consul и др.).

6. **Alertmanager**  
   Компонент для управления уведомлениями на основе правил (например, отправка алерта при высокой загрузке CPU).

7. **Pushgateway**  
   Промежуточный сервис для сбора метрик от задач с коротким сроком жизни (например, cron-задач).

---

### Пример метрики с лейблами:
```plaintext
http_requests_total{method="GET", path="/status", status="200"} 1500
```
- **Метрика**: `http_requests_total` (счётчик HTTP-запросов).
- **Лейблы**: `method`, `path`, `status` (дополнительные атрибуты запроса).
- **Значение**: 1500 (число успешных GET-запросов к `/status`).

---

### Как используются лейблы в PromQL?
- Фильтрация:  
  `http_requests_total{status="500"}`         # Выведет только 500-ые статусы по лейблу status
- Группировка:  
  `sum by (method) (http_requests_total)`     # Отсортирует сумму по лейблу метод каждого HTTP запроса
- Агрегация:  
  `rate(http_requests_total{job="api"}[5m])`  # Cчитает, насколько быстро увеличивается значение метрики за последние 5 минут

Лейблы делают метрики гибкими и позволяют анализировать данные с разных ракурсов.
